# 2020-Django 3 by Example

#### Starting the Social Website Project

Setting up the virtual environment:
```python
mkdir env
python3 -m venv env/bookmarks 
source env/bookmarks/bin/activate
```

Setting up an Admin-account:

python3 manage.py createsuperuser

if server is blogged - just type: thisisunsafe anywhere on the site.

Setting up the Django Project:
```python
pip3 install Django
django-admin startproject bookmarks
cd bookmarks/
django-admin startapp account
```

Register the Account app in the _settings.py_ file:
```python
INSTALLED_APPS = [ 'account.apps.AccountConfig', # ...
]
```
Sync Database with the models 
```python
python3 manage.py migrate
```

-> Django auth templates will be defined later

Libraries needed:
pip3 install Pillow==7.0.0;
pip3 install social-auth-app-django==3.1.0;
pip3 install django-extensions==2.2.5; 
pip3 install werkzeug==0.16.0; 
pip3 install pyOpenSSL==19.0.0;
pip3 install easy-thumbnails==2.7;

### Chapter 4: Building a Social Website

- Django AUth framework is included in default settings of the project (used it for admin in earlier chapters).
- Consists of django.contrib.auth application and two middleware classes: AuthentificationMiddleware (associates users with requests using sessions), and SessionMiddleware (handles the current session across requests).
- Auth framework includes three models:
    - User: User model with basic fields (username, password, mail, first_name, ...)
    - Group: group model to categorize users
    - Permission: Flags for users or groups to perform certain actions

#### Create a login view

- Create a new forms.py in account application
- Edit the views.py file to add the user_login method
- The difference between auth and login:
    - Authenticate: checks user credentials and returns a User object.
    - Login: sets the user in the current session.
- Create the URL pattern of this view by craeting a new urls.py file. Edit the urls.py file in the django base project.
- Create a template for the view (login page). Starting with the base.html template which will be extended by the login.html file (add the .css from the books source code).
- Create a superuser in order to create users because there is no registration yet.
-> This was a manual process for understanding. Usually, you take the default Django authentification views.

Views:
- Class-based views: Login and Logout views
- Views for password change: passwordchangeview and passwordchangedoneview
- Password reset views: PasswordResetView, pwresetdoneview, passwordresetconfirmview, passwordresetcompleteview

Login and logout views: 
- You have added the built-in Django authentication log in and log out views to your project
- You have created custom templates for both views and defined a simple dashboard view to redirect users after they log in
- Finally, you have configured your settings for Django to use these URLs by default
- Now log-in/log-out links need to be added to the base template, therefore it must be determined if user is logged in or not. 
- Next the change password views are integrated: add new dedicated htmls in the templates/registration directory; 
Resetting password views: 
- extend the urls.py with the respective views
- add a dedicated html-form named password_reset_form.html and a password_reset_email.html (this will include a reset token generated by the view).
- also create 'password_reset_done.html' and 'password_reset_confirm.html', and 'password_reset_complete.html' files
- adapt the link in registration/login.html href to '{% url "password_reset %}'
- next a SMTP configuration is needed in the settings.py to send mails via Django. Here this is done via the EMAIL_BACKEND 

#### User Registration
- Create a simple view to allow users to register (with realname, mail, username, and password)
- edit the forms.py in the account directory; in the form two passwords (1 and 2) are given for checking them
- Django also has a UserRegistrationForm
- extend views.py by 'def register():' function; instead of saving the raw password the 'set_password()' function is used.
- adapt the urls.py file and add the register path
- create a new template named register.html in account/ directory
- add template register_done.html 

#### Extending the User Model
- e.g. images and date_of_birth are added
- make sure you run the makemigrations functions to update the database

#### Using the Messages Framework
- django.contrib.messages allows you to show one-time messages to users.
- messages are stored in a cookie by default; therefore import the messages module
- u can display the messages in the base template 

#### Building a custom authentification backend
- this way you can authenticate against LDAP for instance

#### Adding social authentication to your site
- use social-auth-app-django==3.1.0 to connect via Twitter, Facebook or Google
- register the installed_app 'social_django'
- next add the social login URL pattern to urs.py as a path 'social-auth/'

#### Running the development server through HTTPS
- only do this on development server; never on deployed web server!
- use external third party django app RunServerPlus for the HTTPS support; Django can't do it but the social media services demand it
- install django extensions: pip install django-extensions==2.2.5
- debugger layer for RunServerPlus extension: pip install werkzeug==0.16.0
- install pyOpenSSL which is requ for RSP: pip install pyOpenSSL==19.0.0
- register the app in settings.py as 'django_extensions'
- now you need to run the server with a certificate file: python manage.py runserver_plus --cert-file cert.crt

#### Authentification using Facebook
- add the facebook auth to the settings.py: 'social_core.backends.facebook.FacebookOAuth2',
- u need a [facebook developer account]( https://developers.facebook.com/apps/) and a new facebook application in the django project.
- do some fiddling on the facebook web page. Use it once, you try this out.
- After setting everything on the facebook page, you can add the facebook login button to your login.html template.

#### Twitter, and Google are presented too.

#### Summary
- build auth into the site
- implemented views like register, log-in, log-out, edit password, reset password
- buiolt a model for custom user profiles
- created a custom auth backend
- added social auth via Facebook

### Chapter 5

#### Creating an Image Bookmarking Website

##### Build the Image Model
- Create new application within bookmarks called images via django-admin startapp images & register it in the settings.py file of bookmarks
- Edit the models.py file of images application and add the class Image: which will be used to store images retrieved from different sites.
- override the save() method of the Image model to automatically generate the slug field based on the value of the title field. Import the slugify() function and add a save() methode to the Image model 

##### Creating many-2-many relationships

- integrate n2n relationship as multiple users may like an image, and an image can be liked by multiple users 
- a join table is created, field provdes a manager that allows to retrieve related objects, such as image.users_like.all() or get them from a user object such as user.images_liked.all()
- migrate the images database to sync the model with the database
 
##### Registering the image model in the administration file

- edit the admin.py file of the images application and register the Image model, then start the development server
- type 'thisisunsafe' to get access

#### Posting Content from other Websites

- p.153
- 
- 
- 
- 

##### Cleaning form fields
##### Overriding the save() method of a ModelForm
##### Building a bookmarklet with JQuery

#### Creating a Detail View for Images
#### Adding AJAX actions with JQuery

##### Loading JQuery
##### Cross-site requests forgery in AJAX requests
##### Performing AJAX requests with JQuery

#### Creating Custom Decorators for your Views
#### Adding AJAX pagination to your list views








